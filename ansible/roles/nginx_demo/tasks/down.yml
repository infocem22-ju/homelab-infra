---
- name: Stop nginx (best-effort)
  ansible.builtin.shell: |
    set -e
    pkill -TERM nginx 2>/dev/null || true
    sleep 0.5
    pkill -KILL nginx 2>/dev/null || true
  args:
    executable: /bin/bash
  changed_when: true

- name: Ensure nginx port is closed
  ansible.builtin.wait_for:
    host: "{{ nginx_demo_listen_host }}"
    port: "{{ nginx_demo_listen_port }}"
    state: stopped
    timeout: 10
